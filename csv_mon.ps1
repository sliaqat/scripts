<#
	Script that can monitor csv file, extract column value required and display it. 
	required:
		$path = path of csv file
		$fileprefix = prefix of csv file
		$csv_header = header of csv file
		$col_name_to_monitor = which column from the csv header should be monitored. 
#>
$path="C:\Users\Saad\Documents\XPC_20200413-00000002E386F84F-34561\"
$fileprefix="XPC_"

$csv_header="date,_Too_Long_PCAP_Cnt_Cum,_Invld_PCAP_Pckts_Cnt_Cum,__Frames_Cnt_Cum,_Ignored__Frames,__PerSec_Frames_Cum,_Invalid__Frames_Cnt_Cum,_IP__Cnt_Cum,_IPv4__Cnt_Cum,_IPv6__Cnt_Cum,_Bytes_Processed_All_Prtcls_Cum,_Bytes_Discarded_Cum,_Bytes_Ignored_Cum,_Bits_PerSecond_All_Prtcls_Cnt_Act,_Bits_PerSecond_10Sec_All_Prtcls_Cnt_Act,_Bits_PerSecond_60Sec_All_Prtcls_Cnt_Act,_Bits_PerSecond_10_Min_All_Prtcls_Cnt_Act,_Bits_PerSecond_30_Min_All_Prtcls_Cnt_Act,_Bits_PerSecond_1_Hr_All_Prtcls_Cnt_Act,_Bits_PerSecond_1D_All_Prtcls__CntAct,_TCP__Cnt_Cum,_UDP_s_Processable_Cnt_Cum,_Active_TCP_Sessions_Cnt_Act,_TCP_Sessions_Cnt_Cum,_TCP_Sessions_Non_Fresh_Cnt_Cum,_Active_PPPI_TCP_Connections_Cnt_Act,_PPPI_TCP_Connections_Cnt_Cum,_TCP_Sessions_Closed_Cnt_Cum,_TCP_Sessions_Closed_Timeout_Cnt_Cum,_TCP_Bytes_Data_Lost_Cum,_DTX_Trigger_Cnt_Cum,_Active_oding_Context_Cnt_Act,_PerSecond_New_DTX_Cnt_Act,_Active_Traffic_Filters_Cnt_Act,_Active_Traffic_Matches_Cnt_Act,_MBs_Current_Memory_Usage_Act,_Mbps_Current_Throughput_Act,_Current_PageFile_Act,PPPI_HTTP_Instance_Cnt_Cum,PPPI_BLACKBERRY_Instance_Cnt_Cum,PPPI_FTP_Instance_Cnt_Cum,PPPI_H323B_Instance_Cnt_Cum,PPPI_ICQ_Instance_Cnt_Cum,PPPI_IMAP4_Instance_Cnt_Cum,PPPI_IRC_Instance_Cnt_Cum,PPPI_MSN_Instance_Cnt_Cum,PPPI_NNTP_Instance_Cnt_Cum,PPPI_POP3_Instance_Cnt_Cum,PPPI_SIP_Instance_Cnt_Cum,PPPI_SLIRTP_Instance_Cnt_Cum,PPPI_SMTP_Instance_Cnt_Cum,PPPI_TELNET_Instance_Cnt_Cum,PPPI_YMSG_Instance_Cnt_Cum,PPPI_WTP_Instance_Cnt_Cum,PPPI_XMPP_Instance_Cnt_Cum,P3_HTTPBytes_Rcvd_Data_Cum,P3_HTTP_Bytes_Lost_Data_Cum,P3_HTTP_Applications_Cnt_Cum,P3_HTTP_Sessions_Cnt_Cum,P3_HTTP_Documents_Cnt_Cum,P3_HTTP_Start_Missing_Cum,P3_HTTP_End_Missing_Cum,P3_HTTP_Holes_In_File_Cum,P3_HTTP_Active_Conns_Cnt_Act,P3_HTTP_Http_Conns_Cnt_Cum,P3_HTTP_Active_Client_Ctx_Cnt_Act,P3_HTTP_Http_Client_Ctx_Cnt_Cum,P3_BLACKBERRY_Bytes_Rcvd_Data_Cum,P3_BLACKBERRY_Bytes_Lost_Data_Cum,P3_BLACKBERRY_Applications_Cnt_Cum,P3_BLACKBERRY_Sessions_Cnt_Cum,P3_BLACKBERRY_Documents_Cnt_Cum,P3_BLACKBERRY_Start_Missing_Cum,P3_BLACKBERRY_End_Missing_Cum,P3_BLACKBERRY_Holes_In_File_Cum,P3_FTP_Bytes_Rcvd_Data_Cum,P3_FTP_Bytes_Lost_Data_Cum,P3_FTP_Applications_Cnt_Cum,P3_FTP_Sessions_Cnt_Cum,P3_FTP_Documents_Cnt_Cum,P3_FTP_Start_Missing_Cum,P3_FTP_End_Missing_Cum,P3_FTP_Holes_In_File_Cum,P3_H323_Bytes_Rcvd_Data_Cum,P3_H323_Bytes_Lost_Data_Cum,P3_H323_Applications_Cnt_Cum,P3_H323_Sessions_Cnt_Cum,P3_H323_Documents_Cnt_Cum,P3_H323_Start_Missing_Cum,P3_H323_End_Missing_Cum,P3_H323_Holes_In_File_Cum,P3_H323_Msecs_Duration_of_H323_Calls_Cum,P3_H323_H323_Calls_Cnt_Cum,P3_ICQ_Bytes_Rcvd_Data_Cum,P3_ICQ_Bytes_Lost_Data_Cum,P3_ICQ_Applications_Cnt_Cum,P3_ICQ_Sessions_Cnt_Cum,P3_ICQ_Documents_Cnt_Cum,P3_ICQ_Start_Missing_Cum,P3_ICQ_End_Missing_Cum,P3_ICQ_Holes_In_File_Cum,P3_ICQ_ICQ_Connections_Cnt_Cum,P3_ICQ_Unexpectedly_structured_ICQ__Cnt_Cum,P3_ICQ_Extracted_Files_Cnt_Cum,P3_ICQ_Alive_IMMs_Cnt_Act,P3_ICQ_Alive_Parsers_Cnt_Act,P3_IMAP_Bytes_Rcvd_Data_Cum,P3_IMAP_Bytes_Lost_Data_Cum,P3_IMAP_Applications_Cnt_Cum,P3_IMAP_Sessions_Cnt_Cum,P3_IMAP_Documents_Cnt_Cum,P3_IMAP_Start_Missing_Cum,P3_IMAP_End_Missing_Cum,P3_IMAP_Holes_In_File_Cum,P3_IRC_Bytes_Rcvd_Data_Cum,P3_IRC_Bytes_Lost_Data_Cum,P3_IRC_Applications_Cnt_Cum,P3_IRC_Sessions_Cnt_Cum,P3_IRC_Documents_Cnt_Cum,P3_IRC_Start_Missing_Cum,P3_IRC_End_Missing_Cum,P3_IRC_Holes_In_File_Cum,P3_IRC_Active_Conns_Cnt_Act,P3_IRC_Total_Conns_Cnt_Cum,P3_MSN_Bytes_Received_Cum,P3_MSN_Bytes_Lost_Cum,P3_MSN_Applications_Cum,P3_MSN_Sessions_Cum,P3_MSN_Documents_Cum,P3_MSN_Start_Missing_Cum,P3_MSN_End_Missing_Cum,P3_MSN_Holes_In_File_Cum,P3_MSN_MMStream_Cum,P3_MSN_MMStream_Cum,P3_MSN_MMStreamBytes_Cum,P3_NNTP_Bytes_Received_Cum,P3_NNTP_Bytes_Lost_Cum,P3_NNTP_Applications_Cum,P3_NNTP_Sessions_Cum,P3_NNTP_Documents_Cum,P3_NNTP_Start_Missing_Cum,P3_NNTP_End_Missing_Cum,P3_NNTP_Holes_In_File_Cum,P3_POP3_Bytes_Received_Cum,P3_POP3_Bytes_Lost_Cum,P3_POP3_Applications_Cum,P3_POP3_Sessions_Cum,P3_POP3_Documents_Cum,P3_POP3_Start_Missing_Cum,P3_POP3_End_Missing_Cum,P3_POP3_Holes_In_File_Cum,P3_SIP_Bytes_Received_Cum,P3_SIP_Bytes_Lost_Cum,P3_SIP_Applications_Cum,P3_SIP_Sessions_Cum,P3_SIP_Documents_Cum,P3_SIP_Start_Missing_Cum,P3_SIP_End_Missing_Cum,P3_SIP_Holes_In_File_Cum,P3_SIP_MMStream_Cum,P3_SIP_MMStream_Cum,P3_SIP_MMStreamBytes_Cum,P3_SLIRTP_Bytes_Received_Cum,P3_SLIRTP_Bytes_Lost_Cum,P3_SLIRTP_Applications_Cum,P3_SLIRTP_Sessions_Cum,P3_SLIRTP_Documents_Cum,P3_SLIRTP_Start_Missing_Cum,P3_SLIRTP_End_Missing_Cum,P3_SLIRTP_Holes_In_File_Cum,P3_SLIRTP_MMStream_Cum,P3_SLIRTP_MMStream_Cum,P3_SLIRTP_MMStreamBytes_Cum,P3_SMTP_Bytes_Received_Cum,P3_SMTP_Bytes_Lost_Cum,P3_SMTP_Applications_Cum,P3_SMTP_Sessions_Cum,P3_SMTP_Documents_Cum,P3_SMTP_Start_Missing_Cum,P3_SMTP_End_Missing_Cum,P3_SMTP_Holes_In_File_Cum,P3_TELNET_Bytes_Received_Cum,P3_TELNET_Bytes_Lost_Cum,P3_TELNET_Applications_Cum,P3_TELNET_Sessions_Cum,P3_TELNET_Documents_Cum,P3_TELNET_Start_Missing_Cum,P3_TELNET_End_Missing_Cum,P3_TELNET_Holes_In_File_Cum,P3_YMSG_Bytes_Received_Cum,P3_YMSG_Bytes_Lost_Cum,P3_YMSG_Applications_Cum,P3_YMSG_Sessions_Cum,P3_YMSG_Documents_Cum,P3_YMSG_Start_Missing_Cum,P3_YMSG_End_Missing_Cum,P3_YMSG_Holes_In_File_Cum,P3_YMSG_MMStream_Cum,P3_YMSG_MMStream_Cum,P3_YMSG_MMStreamBytes_Cum,P3_WTP_Bytes_Received_Cum,P3_WTP_Bytes_Lost_Cum,P3_WTP_Applications_Cum,P3_WTP_Sessions_Cum,P3_WTP_Documents_Cum,P3_WTP_Start_Missing_Cum,P3_WTP_End_Missing_Cum,P3_WTP_Holes_In_File_Cum,P3_XMPP_Bytes_Received_Cum,P3_XMPP_Bytes_Lost_Cum,P3_XMPP_Applications_Cum,P3_XMPP_Sessions_Cum,P3_XMPP_Documents_Cum,P3_XMPP_Start_Missing_Cum,P3_XMPP_End_Missing_Cum,P3_XMPP_Holes_In_File_Cum,DspiNg_Error_Timeout_Create_Child_Cnt_Cum,DspiNg_Document_Http_Zip_Cnt_Act,DspiNg_Document_Http_Zip_Cnt_Cum,DspiNg_PerSecond_Document_Http_Zip_Act,DspiNg_Percent_BE_IO_Queue_Current_Max_One,DspiNg_Percent_BE_IO_Queue_Current_Overall,DspiNg_Percent_Xlate_Queue_Current_Max_one,DspiNg_Percent_Xlate_Queue_Current_Overall,DspiNg_Sessions_Cnt_Act,DspiNg_Sessions_Cnt_Cum,DspiNg_PerSecond_Sessions_Act,DspiNg_Documents_Cnt_Act,DspiNg_Documents_Cnt_Cum,DspiNg_PerSecond_Documents_Act,DspiNg_Document_Emails_Cnt_Act,DspiNg_Document_Emails_Cnt_Cum,DspiNg_PerSecond_Document_Emails_Act,_Mediator_Connection_Act,_Mediator_Connection_Cum,_Mediator_Bytes_Received_Cum,_Mediator_Pcap_Bytes_Received_Cum,_Mediator_oding_Context_Act,_Mediator_Stream_Act,_Mediator_Error_Cum,_Mediator_Warning_Cum,_Mediator_Removed_Context_Slowdown_Cum,_Mediator_Connection_Act,_Mediator_Connection_Cum,_Mediator_Bytes_Received_Cum,_Mediator_Pcap_Bytes_Received_Cum,_Mediator_oding_Context_Act,_Mediator_Stream_Act,_Mediator_Error_Cum,_Mediator_Warning_Cum,_Mediator_Removed_Context_Slowdown_Cum"
$col_name_to_monitor="_Mediator_Bytes_Received_Cum"


# get column number
$cols=$csv_header.Split(",")
$col_number = $cols.IndexOf($col_name_to_monitor)

# get latest file in directory
$file=gci $path$fileprefix* | sort LastWriteTime | select -last 1

# read last 5 lines of csv file
$lines = Get-content -tail 5 $file

write-host "Checking column : " $col_name_to_monitor
# get the value
ForEach ($line in  $lines) {
    $values=$line.Split(",")
    if ($values.Count -gt 1) { #if condition just to avoid empty rows in csv file
        $dt=$values[0]
        $val_to_read = $values[$col_number]
        write-host "@:" $dt " value="$val_to_read
    }
}
